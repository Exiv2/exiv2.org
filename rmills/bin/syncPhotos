#!/usr/bin/env bash
# set -v

if [ ${BASH_VERSINFO[0]} -lt 4 ]; then
	echo "$0 requires bash 4 (or higher)"
	exit 2
fi

year=$(date +"%Y")
directory=~/Pictures/Photos/$year

if [ ! -d "$directory" ]; then
	echo "$directory is not a directory"
	exit 1
fi

# determine destination and check it's on-line 
host=$(hostname|cut -d. -f 1)
if [ "$host" == 'rmillsm1' ]; then dest=rmillsmm ; fi
if [ "$host" == 'rmillsmm' ]; then dest=rmillsm1 ; fi
if [ ! -z "$dest" ]; then
	ping -c 1 $dest 2>&1 >/dev/null
	if [ "$?" != "0" ]; then 
  		echo "dest $dest is down!"
  		dest=''
  	fi
fi 
echo "host = $host dest = $dest"

if [ "$host" == "rmillsm1" ]; then
	declare -A drives=( \
	   ["Backup"]="rmills@$dest:/Volumes/Backup/Photos/"
	   ["Photos"]="rmills@$dest:~/Pictures/Photos/"
	)
elif [ "$host" == "rmillsmm" ]; then
	declare -A drives=( \
	   ["Backup"]="/Volumes/Backup/Photos/"
	   ["Photos"]="rmills@$dest:~/Pictures/Photos/"
	)
fi


reportDrives() {
	for drive in "${!drives[@]}"; do
		to=${drives["$drive"]}
		if [ ! -d "$to" ]; then
			echo "Drive: '$drive' not available because $to is not a directory"
		fi
	done
}

##
# write the drives we can find
for drive in "${!drives[@]}"; do
	to=${drives["$drive"]}
	echo "drive " $drive is $to
	#if [ -d "$to" ]; then
		echo '---' rsync -varz "$directory" "$to" '---'
			       rsync -varz "$directory" "$to"
		echo
	#else
	#	echo '***'"$to does not exist"'***'
	#fi
done

# reportDrives

# That's all Folks!
##
